name: test
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: build docker stack
        run: docker-compose up -d
      - name: Sleep for 15 seconds
        run: sleep 15s
        shell: bash
      - name: test - healthcheck
        run: >
          curl
          -m 1
          --silent
          --show-error
          --fail
          "localhost:8080/healthcheck"
      - name: test - create poll
        run: >
          curl
          --request POST
          -m 1
          --header "Content-Type: application/json"
          --data '{"title":"test","options":["a","b","c","d"],"expiration":9999999999999,"limit_ip":true}'
          --silent
          --show-error
          --fail
          "localhost:8080/poll"
